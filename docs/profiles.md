# プロファイル管理ガイド

MdTexでは、複数の設定プロファイルを作成・管理できます。異なる用途（論文、スライド、レポートなど）で異なる設定を使い分けることができます。

---

## 目次

- [プロファイルとは](#プロファイルとは)
- [プロファイルの作成](#プロファイルの作成)
- [プロファイルの切り替え](#プロファイルの切り替え)
- [プロファイルの削除](#プロファイルの削除)
- [使用例](#使用例)
- [ベストプラクティス](#ベストプラクティス)

---

## プロファイルとは

プロファイルとは、PandocとLaTeXの設定をまとめたセットです。各プロファイルには以下が含まれます：

- Pandocのパスと追加引数
- 出力フォーマットとディレクトリ
- LaTeXエンジンとドキュメントクラス
- フォントサイズと余白
- LaTeXプリアンブル
- クロスリファレンスの設定
- その他の詳細設定

### なぜプロファイルが必要か

1. **用途別の設定**
   - 論文用：A4、余白広め、12ptフォント
   - スライド用：Beamerクラス、小さなフォント
   - レポート用：カラー図表、中程度の余白

2. **プロジェクト別の設定**
   - プロジェクトA用：特定のヘッダー、出力先
   - プロジェクトB用：別のヘッダー、別の出力先

3. **実験用の設定**
   - 本番用：安定した設定
   - テスト用：新しいパッケージや設定を試す

---

## プロファイルの作成

### 方法1: 設定画面から作成

1. **設定画面を開く**
   - Obsidian設定 → コミュニティプラグイン → MdTexプラグイン設定

2. **新しいプロファイルを作成する**
   - 「新しいプロファイルを作成」セクションに移動
   - プロファイル名を入力（例: `論文用`、`スライド用`）
   - 「プロファイルを追加」ボタンをクリック

3. **新しいプロファイルが作成される**
   - 現在のプロファイルの設定がコピーされます
   - 自動的に新しいプロファイルがアクティブになります

### 方法2: 設定の調整

プロファイル作成後、必要に応じて設定を調整します：

```
論文用プロファイルの設定例:
├── 出力フォーマット: pdf
├── LaTeXエンジン: lualatex
├── ドキュメントクラス: ltjarticle
├── ドキュメントクラスのオプション: a4paper
├── フォントサイズ: 12pt
├── マージン幅: 30mm
└── LaTeXプリアンブル: 論文用にカスタマイズ
```

---

## プロファイルの切り替え

### 設定画面から切り替え

1. 設定画面の「使用するプロファイル」セクションに移動
2. ドロップダウンメニューから目的のプロファイルを選択
3. 設定が自動的に保存されます

### ショートカットでの切り替え

現在、プロファイルのショートカット切り替えは組み込まれていません。以下のワークアラウンドがあります：

**方法1: QuickAddプラグインを使用**
```javascript
// QuickAddのMacroでの使用例
const {update} = this.app.plugins.plugins["mdtex-plugin"].settings;
this.app.plugins.plugins["mdtex-plugin"].settings.activeProfile = "論文用";
await this.app.plugins.plugins["mdtex-plugin"].saveSettings();
new Notice("プロファイルを「論文用」に切り替えました");
```

**方法2: コマンドパレットから設定画面を開く**
- Cmd/Ctrl+P → "MdTexプラグイン設定"
- プロファイルを選択

---

## プロファイルの削除

### 削除手順

1. 削除したいプロファイルをアクティブにする
2. 設定画面の「現在のプロファイルを削除」セクションに移動
3. 「プロファイルを削除」ボタンをクリック
4. 確認ダイアログで「OK」をクリック

### 注意事項

- プロファイルが1つしかない場合は削除できません
- 削除後、別のプロファイルに自動的に切り替わります
- 削除は元に戻せません（必要なら再作成してください）

---

## 使用例

### 例1: 論文用プロファイル

**目的**: 学術論文のPDF生成

```yaml
プロファイル名: 論文用
設定:
  出力フォーマット: pdf
  ドキュメントクラス: ltjarticle
  ドキュメントクラスのオプション: a4paper
  フォントサイズ: 12pt
  マージン幅: 30mm
  Pandoc追加引数: --toc --number-sections
  LaTeXプリアンブル: |
    % 論文用追加設定
    \usepackage{natbib}
    \bibliographystyle{plain}
```

### 例2: スライド用プロファイル（Beamer）

**目的**: プレゼンテーションPDFの生成

```yaml
プロファイル名: スライド用
設定:
  出力フォーマット: pdf
  ドキュメントクラス: beamer
  フォントサイズ: 10pt
  Pandoc Crossref: 無効（競合を防ぐ）
  マージンを指定: 無効
  LaTeXプリアンブル: |
    \usepackage{microtype}
    \usepackage{luatexja}
    \usepackage[noto-otf]{luatexja-preset}
    \setmainfont{Noto Sans CJK JP}
    \setsansfont{Noto Sans CJK JP}
```

**詳細**: [Beamerガイド](./beamer-guide.md)

### 例3: レポート用プロファイル

**目的**: 社内レポートやドキュメント

```yaml
プロファイル名: レポート用
設定:
  出力フォーマット: pdf
  ドキュメントクラス: ltjarticle
  フォントサイズ: 11pt
  マージン幅: 25mm
  ページ番号: 有効
  出力ディレクトリ: ./reports
  Pandoc追加引数: --toc
```

### 例4: LaTeXソース出力用

**目的**: LaTeXソースファイルの生成（手動調整用）

```yaml
プロファイル名: LaTeXソース用
設定:
  出力フォーマット: latex
  中間ファイルを削除: 無効（.texファイルを保持）
  LaTeXプリアンブル: 最小限の設定
```

### 例5: DOCX出力用

**目的**: Microsoft Word文書の生成

```yaml
プロファイル名: Word用
設定:
  出力フォーマット: docx
  Pandoc追加引数: --reference-doc=reference.docx
  高度なLaTeXコマンド: 有効
  Luaフィルタのパス: tex-to-docx.lua
```

---

## ベストプラクティス

### 1. 命名規則

プロファイル名は用途が明確に分かるように命名します：

- 良い例: `論文-A4-12pt`、`スライド-Beamer`、`レポート-標準`
- 避ける例: `profile1`、`設定2`、`新しいプロファイル`

### 2. ベースプロファイルの作成

共通設定を含む「ベース」または「デフォルト」プロファイルを作成し、それをコピーして派生プロファイルを作ります。

```
ベース（共通設定）
├── 論文用（ベースをコピー + 論文特有の設定）
├── スライド用（ベースをコピー + Beamer設定）
└── レポート用（ベースをコピー + レポート特有の設定）
```

### 3. ドキュメント化

プロファイルの用途をメモに残します：

```markdown
# MdTexプロファイル一覧

## 論文用
- 用途: 学会論文投稿用
- 特徴: A4、余白30mm、12pt
- 作成日: 2025-01-15

## スライド用
- 用途: 研究室発表用
- 特徴: Beamer、Notoフォント
- 注意: pandoc-crossrefは無効
```

### 4. バージョン管理

重要なプロファイル設定はバージョン管理することを検討：

```bash
# 設定ファイルのバックアップ
cp .obsidian/plugins/obsidian-mdtex-plugin/data.json \
   .obsidian/plugins/obsidian-mdtex-plugin/data.json.backup
```

### 5. 設定のエクスポート/インポート

他のデバイスやVaultと設定を共有する場合：

1. 設定ファイル（`data.json`）をコピー
2. 新しい環境に配置
3. Obsidianを再起動

---

## トラブルシューティング

### プロファイルが表示されない

**原因**: 設定ファイルの読み込みエラー

**対処**:
1. Obsidianを再起動
2. 設定ファイル（`data.json`）が存在するか確認
3. JSONの構文エラーをチェック

### プロファイルの切り替えが反映されない

**原因**: 設定のキャッシュ

**対処**:
1. 設定画面を閉じて再度開く
2. Obsidianを再起動

### プロファイルの削除ができない

**原因**: プロファイルが1つしかない

**対処**:
1. 新しいプロファイルを作成してから削除
2. 最低1つのプロファイルは必要

---

## 関連ドキュメント

- [設定リファレンス](./configuration.md)
- [クイックスタート](./quickstart.md)
- [Beamerガイド](./beamer-guide.md)
- [トラブルシューティング](./troubleshooting.md)
