# LaTeXコマンドパレット

LaTeXコマンドパレットは、よく使うLaTeXコマンドを検索・挿入する機能です。インライン補完やゴーストテキスト機能も提供します。

---

## 目次

- [機能概要](#機能概要)
- [コマンドパレットの使い方](#コマンドパレットの使い方)
- [インライン補完](#インライン補完)
- [ゴーストテキスト補完](#ゴーストテキスト補完)
- [カスタムコマンドの追加](#カスタムコマンドの追加)
- [デフォルトコマンド一覧](#デフォルトコマンド一覧)

---

## 機能概要

LaTeXコマンドパレットは以下の3つの機能を提供します：

1. **コマンドパレット**: モーダルウィンドウからコマンドを検索・選択
2. **インライン補完**: エディタで`@`入力でコマンドをサジェスト
3. **ゴーストテキスト**: 入力中に候補を薄く表示（Tab/→で確定）

---

## コマンドパレットの使い方

### 起動方法

1. **コマンドパレットから**
   - Cmd/Ctrl+P → 「LaTeXコマンドを検索して挿入」

2. **ショートカット**
   - カスタムショートカットを設定できます（Obsidianの設定 → ショートカット）

### 使用方法

1. コマンドパレットが開くと、利用可能なコマンドの一覧が表示されます
2. キーワードを入力してコマンドを検索（例: `newpage`、`vspace`）
3. 目的のコマンドを選択してEnter
4. コマンドがカーソル位置に挿入されます

### 検索のコツ

- コマンド名（例: `\newpage`）
- 説明文（例: `改ページ`）
- 部分的な入力でも検索可能（例: `new`で`\newpage`がヒット）

---

## インライン補完

エディタ内で直接コマンドを補完できます。

### 使用方法

1. エディタで`@`を入力
2. コマンド候補が表示されます
3. 方向キーで選択、Enterで挿入
4. または、コマンド名を直接入力してTabで補完

### 補完の流れ

```
入力: @vspace
↓
候補表示:
  ▶ \vspace{} - Custom vertical space (高さ指定)
    \hspace{} - Custom horizontal space (幅指定)
↓
選択してEnter
↓
挿入: \vspace{|}  （|はカーソル位置）
```

### 有効/無効の切り替え

設定画面で「LaTeXパレットとインライン補完を有効」をオン/オフできます。

---

## ゴーストテキスト補完

入力中に候補を薄い文字で表示し、素早く確定できます。

### 使用方法

1. LaTeXコマンドを入力し始める（例: `\new`）
2. 候補がゴーストテキストとして表示される（例: `\newpage`）
3. **Tab** または **→（右矢印）** で確定
4. **Esc** または続けて入力でキャンセル

### 動作例

```
入力: \vspa
表示: \vspa[ce{}]  （[]内がゴーストテキスト）
↓
Tabキーを押す
↓
結果: \vspace{|}
```

### 有効/無効の切り替え

設定画面で「インラインゴースト補完を有効（実験的）」をオン/オフできます。

---

## カスタムコマンドの追加

自分好みのコマンドを追加できます。

### YAML形式での定義

設定画面の「コマンド一覧（YAML）」セクションで編集します。

```yaml
- cmd: "\\newcommand{\\mycommand}{}"
  desc: "カスタムコマンドの定義"
  cursorOffset: -1

- cmd: "\\textcolor{red}{}"
  desc: "赤色のテキスト"
  cursorOffset: -1

- cmd: "\\includegraphics[width=0.8\\textwidth]{}"
  desc: "画像の挿入（スケール指定）"
  cursorOffset: -1
```

### フィールドの説明

| フィールド | 必須 | 説明 |
|-----------|------|------|
| `cmd` | 必須 | LaTeXコマンド（バックスラッシュは`\\`でエスケープ） |
| `desc` | 必須 | コマンドの説明（検索に使用） |
| `cursorOffset` | 任意 | 挿入後のカーソル位置調整（-1で{}内） |

### cursorOffsetの使い方

```yaml
# cursorOffset: -1 の場合
- cmd: "\\vspace{}"
  desc: "垂直スペース"
  cursorOffset: -1
# 挿入後: \vspace{|}  （カーソルが{}内）

# cursorOffsetなしの場合
- cmd: "\\newpage"
  desc: "改ページ"
# 挿入後: \newpage|  （カーソルが末尾）
```

### デフォルトに戻す

「デフォルトコマンドに戻す」ボタンで初期状態にリセットできます。

---

## デフォルトコマンド一覧

以下のコマンドがデフォルトで登録されています。

### ページ制御

| コマンド | 説明 | cursorOffset |
|---------|------|-------------|
| `\clearpage` | Flush floats and new page (改ページ・図表配置) | - |
| `\newpage` | New page (改ページ) | - |
| `\pagebreak` | Page break with allowed stretch (ページ分割: 伸縮可) | - |

### スペース

| コマンド | 説明 | cursorOffset |
|---------|------|-------------|
| `\bigskip` | Large vertical space (大スペース) | - |
| `\medskip` | Medium vertical space (中スペース) | - |
| `\smallskip` | Small vertical space (小スペース) | - |
| `\vspace{}` | Custom vertical space (高さ指定) | -1 |
| `\hspace{}` | Custom horizontal space (幅指定) | -1 |
| `\hfill` | Horizontal fill (右寄せ等) | - |

### テキスト制御

| コマンド | 説明 | cursorOffset |
|---------|------|-------------|
| `\noindent` | No indentation (段落インデントなし) | - |
| `\\` | Line break (強制改行) | - |

---

## 活用例

### 例1: よく使うマクロを登録

```yaml
- cmd: "\\newcommand{\\keyword}[1]{\\textbf{#1}}"
  desc: "キーワード強調用マクロの定義"
  cursorOffset: 0

- cmd: "\\keyword{}"
  desc: "キーワードを強調表示"
  cursorOffset: -1
```

### 例2: 環境の挿入

```yaml
- cmd: "\\begin{figure}[H]\n  \\centering\n  \\includegraphics[width=0.8\\textwidth]{}\n  \\caption{}\n  \\label{fig:}\n\\end{figure}"
  desc: "Figure環境のテンプレート"
  cursorOffset: -50
```

### 例3: 数学記号

```yaml
- cmd: "\\mathbb{R}"
  desc: "実数の集合"
  cursorOffset: 0

- cmd: "\\rightarrow"
  desc: "右向き矢印"
  cursorOffset: 0

- cmd: "\\frac{}{}"
  desc: "分数"
  cursorOffset: -3
```

### 例4: 引用形式

```yaml
- cmd: "\\cite{}"
  desc: "引用"
  cursorOffset: -1

- cmd: "\\citep{}"
  desc: "括弧付き引用"
  cursorOffset: -1

- cmd: "\\citet{}"
  desc: "文中引用"
  cursorOffset: -1
```

---

## トラブルシューティング

### コマンドパレットが開かない

**原因**: 機能が無効になっている

**対処**: 設定で「LaTeXパレットとインライン補完を有効」をオンにする

### コマンドが挿入されない

**原因**: エディタにフォーカスがない

**対処**: Markdownファイルのエディタをクリックしてフォーカスを当てる

### YAMLのパースエラー

**原因**: コマンド定義のYAML構文が不正

**対処**:
1. YAML構文を確認
2. バックスラッシュは`\\`でエスケープ
3. 「デフォルトコマンドに戻す」でリセット

### ゴーストテキストが表示されない

**原因**: 機能が無効、または競合

**対処**:
1. 設定で「インラインゴースト補完を有効」をオンにする
2. 他の補完プラグインと競合していないか確認

---

## ヒントとコツ

### 1. よく使うコマンドは先頭に

頻繁に使用するコマンドはYAMLの先頭に配置すると見つけやすくなります。

### 2. 段階的なカスタマイズ

一度に全てを変更せず、必要なコマンドから順次追加していきます。

### 3. コメントを活用

```yaml
# ページ制御
- cmd: "\\newpage"
  desc: "改ページ"

# 数式
- cmd: "\\frac{}{}"
  desc: "分数"
  cursorOffset: -3
```

### 4. バックアップを取る

カスタマイズしたYAMLは設定ファイルに保存されます。重要なカスタマイズはメモに残しておきましょう。

---

## 関連ドキュメント

- [設定リファレンス](./configuration.md)
- [機能一覧](./features.md)
- [クイックスタート](./quickstart.md)
